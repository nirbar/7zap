cmake_minimum_required (VERSION 3.23)

set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")					
add_compile_definitions(Z7_PROG_VARIANT_R)

# Common
list(APPEND src_7zr_shared CPP/Common/CommandLineParser.cpp)
list(APPEND src_7zr_shared CPP/Common/CRC.cpp)
list(APPEND src_7zr_shared CPP/Common/CrcReg.cpp)
list(APPEND src_7zr_shared CPP/Common/DynLimBuf.cpp)
list(APPEND src_7zr_shared CPP/Common/IntToString.cpp)
list(APPEND src_7zr_shared CPP/Common/ListFileUtils.cpp)
list(APPEND src_7zr_shared CPP/Common/LzFindPrepare.cpp)
list(APPEND src_7zr_shared CPP/Common/NewHandler.cpp)
list(APPEND src_7zr_shared CPP/Common/StdInStream.cpp)
list(APPEND src_7zr_shared CPP/Common/StdOutStream.cpp)
list(APPEND src_7zr_shared CPP/Common/MyString.cpp)
list(APPEND src_7zr_shared CPP/Common/Sha256Reg.cpp)
list(APPEND src_7zr_shared CPP/Common/StringConvert.cpp)
list(APPEND src_7zr_shared CPP/Common/StringToInt.cpp)
list(APPEND src_7zr_shared CPP/Common/UTFConvert.cpp)
list(APPEND src_7zr_shared CPP/Common/MyVector.cpp)
list(APPEND src_7zr_shared CPP/Common/Wildcard.cpp)
list(APPEND src_7zr_shared CPP/Common/XzCrc64Init.cpp)
list(APPEND src_7zr_shared CPP/Common/XzCrc64Reg.cpp)

# Windows
list(APPEND src_7zr_shared CPP/Windows/DLL.cpp)
list(APPEND src_7zr_shared CPP/Windows/ErrorMsg.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileDir.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileFind.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileIO.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileLink.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileName.cpp)
list(APPEND src_7zr_shared CPP/Windows/FileSystem.cpp)
list(APPEND src_7zr_shared CPP/Windows/MemoryLock.cpp)
list(APPEND src_7zr_shared CPP/Windows/PropVariant.cpp)
list(APPEND src_7zr_shared CPP/Windows/PropVariantConv.cpp)
list(APPEND src_7zr_shared CPP/Windows/Registry.cpp)
list(APPEND src_7zr_shared CPP/Windows/System.cpp)
list(APPEND src_7zr_shared CPP/Windows/SystemInfo.cpp)
list(APPEND src_7zr_shared CPP/Windows/TimeUtils.cpp)

# 7zip Common
list(APPEND src_7zr_shared CPP/7zip/Common/CreateCoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/CWrappers.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/FilePathAutoRename.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/FileStreams.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/InBuffer.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/InOutTempBuffer.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/FilterCoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/LimitedStreams.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/MethodId.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/MethodProps.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/MultiOutStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/OffsetStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/OutBuffer.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/ProgressUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/PropId.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/StreamBinder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/StreamObjects.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/StreamUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/UniqBlocks.cpp)
list(APPEND src_7zr_shared CPP/7zip/Common/VirtThread.cpp)

# 7zip Archive
list(APPEND src_7zr_shared CPP/7zip/Archive/LzmaHandler.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/SplitHandler.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/XzHandler.cpp)

# AR_COMMON_OBJS
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/CoderMixer2.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/DummyOutStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/HandlerOut.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/InStreamWithCRC.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/ItemNameUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/MultiStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/OutStreamWithCRC.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/Common/ParseProperties.cpp)

# 7Z_OBJS
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zCompressionMode.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zDecode.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zEncode.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zExtract.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zFolderInStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zHandler.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zHandlerOut.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zHeader.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zIn.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zOut.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zProperties.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zSpecStream.cpp)
list(APPEND src_7zr_shared CPP/7zip/Archive/7z/7zUpdate.cpp)

# COMPRESS_OBJS
list(APPEND src_7zr_shared CPP/7zip/Compress/Bcj2Coder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/Bcj2Register.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/BcjCoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/BcjRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/BranchMisc.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/BranchRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/ByteSwap.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/CopyCoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/CopyRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/DeltaFilter.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/Lzma2Decoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/Lzma2Encoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/Lzma2Register.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/LzmaDecoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/LzmaEncoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/LzmaRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/XzDecoder.cpp)
list(APPEND src_7zr_shared CPP/7zip/Compress/XzEncoder.cpp)

# CRYPTO_OBJS
list(APPEND src_7zr_shared CPP/7zip/Crypto/7zAes.cpp)
list(APPEND src_7zr_shared CPP/7zip/Crypto/7zAesRegister.cpp)
list(APPEND src_7zr_shared CPP/7zip/Crypto/MyAes.cpp)
list(APPEND src_7zr_shared CPP/7zip/Crypto/MyAesReg.cpp)
list(APPEND src_7zr_shared CPP/7zip/Crypto/RandGen.cpp)

# C_OBJS
list(APPEND src_7zr_shared C/7zStream.c)
list(APPEND src_7zr_shared C/Alloc.c)
list(APPEND src_7zr_shared C/Bcj2.c)
list(APPEND src_7zr_shared C/Bcj2Enc.c)
list(APPEND src_7zr_shared C/Bra.c)
list(APPEND src_7zr_shared C/Bra86.c)
list(APPEND src_7zr_shared C/BraIA64.c)
list(APPEND src_7zr_shared C/CpuArch.c)
list(APPEND src_7zr_shared C/Delta.c)
list(APPEND src_7zr_shared C/LzFind.c)
list(APPEND src_7zr_shared C/LzFindMt.c)
list(APPEND src_7zr_shared C/Lzma2Dec.c)
list(APPEND src_7zr_shared C/Lzma2DecMt.c)
list(APPEND src_7zr_shared C/Lzma2Enc.c)
list(APPEND src_7zr_shared C/LzmaDec.c)
list(APPEND src_7zr_shared C/LzmaEnc.c)
list(APPEND src_7zr_shared C/MtCoder.c)
list(APPEND src_7zr_shared C/MtDec.c)
list(APPEND src_7zr_shared C/Sort.c)
list(APPEND src_7zr_shared C/SwapBytes.c)
list(APPEND src_7zr_shared C/Threads.c)
list(APPEND src_7zr_shared C/Xz.c)
list(APPEND src_7zr_shared C/XzDec.c)
list(APPEND src_7zr_shared C/XzEnc.c)
list(APPEND src_7zr_shared C/XzIn.c)

# CONSOLE_OBJS
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/BenchCon.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/ConsoleClose.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/ExtractCallbackConsole.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/HashCon.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/List.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/OpenCallbackConsole.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/PercentPrinter.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/UpdateCallbackConsole.h)
list(APPEND hdr_7zr_shared CPP/7zip/UI/Console/UserInputUtils.h)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/BenchCon.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/ConsoleClose.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/ExtractCallbackConsole.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/HashCon.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/List.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/OpenCallbackConsole.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/PercentPrinter.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/UpdateCallbackConsole.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Console/UserInputUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/ArchiveCommandLine.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/ArchiveExtractCallback.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/ArchiveOpenCallback.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/Bench.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/DefaultName.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/EnumDirItems.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/Extract.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/ExtractingFilePath.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/HashCalc.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/LoadCodecs.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/OpenArchive.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/PropIDUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/SetProperties.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/SortUtils.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/TempFiles.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/Update.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/UpdateAction.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/UpdateCallback.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/UpdatePair.cpp)
list(APPEND src_7zr_shared CPP/7zip/UI/Common/UpdateProduce.cpp)
list(APPEND src_7zr_shared C/DllSecur.c)

# AES
list(APPEND src_7zr_shared C/Aes.c) #TODO Not including .asm files
list(APPEND src_7zr_shared C/AesOpt.c)

# CRC
list(APPEND src_7zr_shared C/7zCrc.c) #TODO Not including .asm files
list(APPEND src_7zr_shared C/7zCrcOpt.c)

# Crc64
list(APPEND src_7zr_shared C/XzCrc64.c) #TODO Not including .asm files
list(APPEND src_7zr_shared C/XzCrc64Opt.c)

# LzFindOpt.mak
list(APPEND src_7zr_shared C/LzFindOpt.c)

# Sha256.mak
list(APPEND src_7zr_shared CPP/Common/Sha256Prepare.cpp)
list(APPEND src_7zr_shared C/Sha256.c)
list(APPEND src_7zr_shared C/Sha256Opt.c)

#TODO Use asm files were possible

# 7zip.mak
list(APPEND src_7zr_exe C/7zVersion.rc)
list(APPEND src_7zr_exe CPP/7zip/Bundles/Alone7z/StdAfx.cpp)
list(APPEND src_7zr_exe CPP/7zip/UI/Console/Main.cpp)
list(APPEND src_7zr_exe CPP/7zip/UI/Console/MainAr.cpp)

add_library(7zrObj OBJECT ${src_7zr_shared})

add_executable(7zr $<TARGET_OBJECTS:7zrObj>)
target_sources(7zr PRIVATE ${src_7zr_exe}
		PUBLIC ${hdr_7zr_shared})
